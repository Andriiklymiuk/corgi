<div align="center">
  <img width="300" height="300" src="./resources/corgi.png">
  
  # üê∂ CORGI üê∂
  [![Reliability Rating](https://sonarcloud.io/api/project_badges/measure?project=Andriiklymiuk_corgi&metric=reliability_rating)](https://sonarcloud.io/summary/new_code?id=Andriiklymiuk_corgi)
  [![Bugs](https://sonarcloud.io/api/project_badges/measure?project=Andriiklymiuk_corgi&metric=bugs)](https://sonarcloud.io/summary/new_code?id=Andriiklymiuk_corgi)
  [![Code Smells](https://sonarcloud.io/api/project_badges/measure?project=Andriiklymiuk_corgi&metric=code_smells)](https://sonarcloud.io/summary/new_code?id=Andriiklymiuk_corgi)

  [![Security Rating](https://sonarcloud.io/api/project_badges/measure?project=Andriiklymiuk_corgi&metric=security_rating)](https://sonarcloud.io/summary/new_code?id=Andriiklymiuk_corgi)
  [![Vulnerabilities](https://sonarcloud.io/api/project_badges/measure?project=Andriiklymiuk_corgi&metric=vulnerabilities)](https://sonarcloud.io/summary/new_code?id=Andriiklymiuk_corgi)

  [![Maintainability Rating](https://sonarcloud.io/api/project_badges/measure?project=Andriiklymiuk_corgi&metric=sqale_rating)](https://sonarcloud.io/summary/new_code?id=Andriiklymiuk_corgi)
  [![Lines of Code](https://sonarcloud.io/api/project_badges/measure?project=Andriiklymiuk_corgi&metric=ncloc)](https://sonarcloud.io/summary/new_code?id=Andriiklymiuk_corgi)
  [![Technical Debt](https://sonarcloud.io/api/project_badges/measure?project=Andriiklymiuk_corgi&metric=sqale_index)](https://sonarcloud.io/summary/new_code?id=Andriiklymiuk_corgi)

  [![Coverage](https://sonarcloud.io/api/project_badges/measure?project=Andriiklymiuk_corgi&metric=coverage)](https://sonarcloud.io/summary/new_code?id=Andriiklymiuk_corgi)
</div>


## Inside:
- [Quick install with homebrew](#quick-install-with-homebrewhttpsbrewsh-without-repo-cloning)
- [Prerequisites](#prerequisites)
- [Prerequisites to develop](#prerequisites-to-develop)
- [Services creation](#services-creation)
- [How to run](#how-to-run)
- [How to run in dev mode](#how-to-run-in-dev)
- [How to build](#how-to-build)
- [If you want to run without cli](#without-cli)
- [Questions, that might arise](#faq)
- [Autogenerated docs about cli](#autogenerated-docs-for-cli-by-cobra)
- [What is my purpose and why go](./resources/readme/why_it_exists.md)

</br>

## Quick install with [Homebrew](https://brew.sh) without repo cloning 

```bash
brew tap andriiklymiuk/tools https://github.com/andriiklymiuk/tools

brew install corgi

# ask for help to check if it works
corgi -h
```

It will install it globally.

With it you can run `corgi` in any folder on your local.

[Create service file](#services-creation), if you want to run db helpers.

</br>

## Prerequisites
- [Docker](https://www.docker.com)

## Prerequisites to develop
- Golang language - if you want to add go code
  - With homebrew `brew install go` (Recommended)
  - From [official website](https://go.dev)

## Services creation

You need to create corgi-compose.yml file in root of your target repo to create db services.
It should be created in the following way:
```yml
db_services:
  corgi:
    databaseName: corgi-database
    user: corgi
    password: corgiSecurePassword
    port: 5432
  corgiTest:
    databaseName: corgi-database-test
    user: corgi
    password: corgiSecurePasswordTest
    port: 5433
```
Then run, which will create services.
```bash 
  corgi init
```
or, if you are running in corgi repo itself
```bash 
  ./corgi init
```
or, if you are running in dev mode in corgi repo itself
```bash 
  go run . init
```

***Tip***: there can be as many services as you wish. 
But create it with different ports to be able to run in all at the same time, if you want.


## How to run
You can install app in the following ways:
1. With [homebrew](#quick-install-without-repo-cloning-with-homebrew)

2. Run `go install` inside repo and it will install `corgi` globally, same to homebrew, but with homebrew you don't even need to clone corgi repo

3. From repo itself

```bash 
  # this will show you help message
  ./corgi

  # before running db commands you need to create corgi-compose.yml file, add services config there and run corgi init, so that there is db_services folder, that is created

  # example to run db service
  ./corgi db

  # example to show help commands
  ./corgi db -h
  ./corgi -h
```


You can run cli with flags, without specifying service, to do smth with all databases, for example:

```bash 

  # run db service and start all databases
  ./corgi db -u
  # similar to
  ./corgi db -upAll

  # stop, remove and start all databases 
  ./corgi db  -r -s -u
  # similar to
  ./corgi db  -rsu
  # similar to
  ./corgi db  -removeAll -stopAll -upAll
```

You can run each service individually, e.g. `./corgi db`. It will show you interactive menu to choose one of the service databases, that are located in `corgi_services/db_services` folder.

```bash 
Use the arrow keys to navigate: ‚Üì ‚Üë ‚Üí ‚Üê 
? Select service: 
  ‚ñ∏ üõë  close program
    analytics
    backend
    backoffice
```

This menu helps to choose target service and its commands, that are located in Makefile of targeted service (we choose backoffice service for example)

```bash 
Connection info to backoffice:

PORT 5432
USER corgi
PASSWORD corgiPassword
DB corgi-adm

backoffice ist running üî¥
Use the arrow keys to navigate: ‚Üì ‚Üë ‚Üí ‚Üê 
? Select command: 
  ‚ñ∏ ‚¨ÖÔ∏è  go back
    down
    help
    id
    listDocker
    seed
‚Üì   up
```

</br>

## How to run in dev

If you want to add some functionality and test it, you should run in the root folder (requires GO installed).

```bash 
  go run .
```
This command will run cli, similar to `./corgi`, but all code changes will be visible in subsequent reruns. If you want to see changes in `./corgi`, after some code additions, that you need to [build applications](#how-to-build).

**Tip**: 
 - In order to automatically push `corgi` binary to git, you need to run `make fixPreCommitHooks` to make `pre-commit` hook executable

## How to build
To build the application and then run `./corgi` you need
```bash 
  go build
```

</br>

## Without cli

The beauty of this cli is that it is versatile and can be run without even opening cli, if it broke or smth has happened to it.
All database services are in `corgi_services/db_services` folder, so you can go to interested service folder and just run `make up` to start the database.

It can be done so, because cli is dependent upon on `docker-compose.yml` and MAKEFILE for each service, and it can be run independently.


## FAQ
- -bash: ./pre-commit: /bin/bash: bad interpreter: Operation not permitted

For this you need to go to .githooks folder and run 
```
xattr -l pre-commit
```

If you will see in terminal `com.apple.quarantine`, than type
```
xattr -d com.apple.quarantine pre-commit
```
It should fix commit pre hook

- how to do database seeding (population with data)

For this you need to

0. [Create database dump](./resources/readme/database_dump.md), name it `dump.sql` and place it in targeted service, e.g. place it in `corgi_services/db_services/backoffice` folder
1. Run `./corgi db` from root folder
2. Choose service
3. Choose seed. It will populate db.

**Important**: seeding is best to do on newly created db.

## Autogenerated docs for cli by cobra

- [corgi](./resources/readme/corgi.md) - Corgi cli magic friend

</br>



Credits:

- <a href="https://www.freepik.com/free-vector/cute-corgi-dog-astronaut-floating-space-cartoon-vector-icon-illustration-animal-science-icon-concept-isolated-premium-vector-flat-cartoon-style_22271104.htm#query=corgi%20icon&position=7&from_view=keyword">Corgi image by catalyststuff</a> on Freepik
- Random quote is from https://api.quotable.io
